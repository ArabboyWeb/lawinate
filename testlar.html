<!DOCTYPE html>
<html lang="uz" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Testlar | Lawinate.uz</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <!-- Cloudflare Web Analytics --><script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "58db17dfbaa943a2b8c6c7e895c112d3"}'></script><!-- End Cloudflare Web Analytics -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        lawBlue: '#0066FF',
                        lawDark: '#050505',
                        lawCard: '#0F1115',
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #050505;
            color: white;
            background-image:
                radial-gradient(circle at 20% 20%, rgba(0, 102, 255, 0.15) 0%, transparent 40%),
                radial-gradient(circle at 80% 80%, rgba(0, 102, 255, 0.1) 0%, transparent 40%);
        }
        .glass-nav {
            background: rgba(5, 5, 5, 0.7);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        .glass-card {
            background: rgba(15, 17, 21, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
        }
        .glass-card:hover {
            transform: translateY(-5px);
            border-color: rgba(0, 102, 255, 0.3);
            box-shadow: 0 10px 40px -10px rgba(0, 102, 255, 0.2);
        }
        .option-card {
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .option-card:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        .option-card.selected {
            background: rgba(0, 102, 255, 0.15);
            border-color: #0066FF;
            box-shadow: 0 0 15px rgba(0, 102, 255, 0.1);
        }
        /* Natija oynasi uchun */
        .result-circle {
            background: conic-gradient(#0066FF var(--percent), #1f2937 0);
            border-radius: 50%;
            width: 120px;
            height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        .result-circle::before {
            content: '';
            position: absolute;
            width: 100px;
            height: 100px;
            background: #0F1115; /* Card background color */
            border-radius: 50%;
        }
        .progress-bar {
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        #testModal {
            display: none;
        }
        #testModal.active {
            display: flex;
        }
        /* Hide scrollbar for modal content */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>
<body class="antialiased">

    <nav class="fixed w-full z-50 glass-nav">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-20 items-center">
                <a href="index.html" class="flex items-center gap-2 cursor-pointer">
                    <i class="ph-fill ph-scales text-3xl text-lawBlue"></i>
                    <span class="text-2xl font-bold tracking-tight">Lawinate<span class="text-lawBlue">.uz</span></span>
                </a>
                <div class="hidden md:flex space-x-8 text-sm font-medium text-gray-300">
                    <a href="reyting.html" class="hover:text-white transition">Reyting</a>
                    <a href="kutubxona.html" class="hover:text-white transition">Kutubxona</a>
                    <a href="testlar.html" class="text-white transition font-bold">Testlar</a>
                    <a href="ai-assistant.html" class="hover:text-lawBlue transition flex items-center gap-1">
                         <i class="ph-bold ph-sparkle"></i> AI Assistant
                    </a>
                </div>
                <div class="hidden md:flex gap-4">
                    <button class="text-sm font-medium hover:text-white text-gray-300 transition">Kirish</button>
                    <button class="bg-lawBlue hover:bg-blue-600 text-white px-5 py-2 rounded-full text-sm font-semibold transition">
                        Ro'yxatdan o'tish
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <section class="pt-32 pb-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12">
                <h1 class="text-4xl md:text-6xl font-black mb-4">
                    <i class="ph-fill ph-exam text-lawBlue"></i> Test Platformasi
                </h1>
                <p class="text-gray-400 text-lg">Bilimingizni sinang, reytingni egallang va yurist bo'ling</p>
            </div>

            <div class="mb-12">
                <h2 class="text-3xl font-bold mb-8 flex items-center gap-2">
                    <i class="ph-bold ph-squares-four text-lawBlue"></i> Kategoriyalar
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    
                    <div class="glass-card p-8 rounded-3xl relative group cursor-pointer" onclick="initTest('konstitutsiya')">
                        <div class="absolute top-6 right-6">
                            <span class="px-3 py-1 bg-green-500/20 text-green-400 rounded-full text-xs font-semibold">Yangi</span>
                        </div>
                        <div class="w-16 h-16 bg-blue-600/20 rounded-2xl flex items-center justify-center mb-6 group-hover:bg-blue-600 transition">
                            <i class="ph-fill ph-flag text-3xl text-blue-400 group-hover:text-white"></i>
                        </div>
                        <h3 class="text-2xl font-bold mb-3">Konstitutsiya</h3>
                        <p class="text-sm text-gray-400 mb-6">Asosiy qonun bo'yicha bilimlaringizni tekshiring.</p>
                        <button class="w-full bg-lawBlue hover:bg-blue-600 text-white py-3 rounded-xl font-semibold transition">
                            Boshlash
                        </button>
                    </div>

                    <div class="glass-card p-8 rounded-3xl relative group cursor-pointer" onclick="initTest('jinoyat')">
                        <div class="w-16 h-16 bg-red-600/20 rounded-2xl flex items-center justify-center mb-6 group-hover:bg-red-600 transition">
                            <i class="ph-fill ph-gavel text-3xl text-red-400 group-hover:text-white"></i>
                        </div>
                        <h3 class="text-2xl font-bold mb-3">Jinoyat Huquqi</h3>
                        <p class="text-sm text-gray-400 mb-6">Jinoyat kodeksi va jazo turlari bo'yicha testlar.</p>
                        <button class="w-full bg-lawBlue hover:bg-blue-600 text-white py-3 rounded-xl font-semibold transition">
                            Boshlash
                        </button>
                    </div>

                    <div class="glass-card p-8 rounded-3xl relative group cursor-pointer" onclick="initTest('fuqarolik')">
                        <div class="w-16 h-16 bg-purple-600/20 rounded-2xl flex items-center justify-center mb-6 group-hover:bg-purple-600 transition">
                            <i class="ph-fill ph-handshake text-3xl text-purple-400 group-hover:text-white"></i>
                        </div>
                        <h3 class="text-2xl font-bold mb-3">Fuqarolik Huquqi</h3>
                        <p class="text-sm text-gray-400 mb-6">Mulk, shartnomalar va majburiyatlar huquqi.</p>
                        <button class="w-full bg-lawBlue hover:bg-blue-600 text-white py-3 rounded-xl font-semibold transition">
                            Boshlash
                        </button>
                    </div>

                    <div class="glass-card p-8 rounded-3xl relative group cursor-pointer" onclick="initTest('dtm')">
                        <div class="absolute top-6 right-6">
                            <span class="px-3 py-1 bg-yellow-500/20 text-yellow-400 rounded-full text-xs font-semibold">Mashhur</span>
                        </div>
                        <div class="w-16 h-16 bg-green-600/20 rounded-2xl flex items-center justify-center mb-6 group-hover:bg-green-600 transition">
                            <i class="ph-fill ph-graduation-cap text-3xl text-green-400 group-hover:text-white"></i>
                        </div>
                        <h3 class="text-2xl font-bold mb-3">DTM Tayyorgarlik</h3>
                        <p class="text-sm text-gray-400 mb-6">Universitetlarga kirish uchun huquqshunoslik testlari.</p>
                        <button class="w-full bg-lawBlue hover:bg-blue-600 text-white py-3 rounded-xl font-semibold transition">
                            Boshlash
                        </button>
                    </div>

                    <div class="glass-card p-8 rounded-3xl relative group cursor-pointer" onclick="initTest('mehnat')">
                        <div class="w-16 h-16 bg-orange-600/20 rounded-2xl flex items-center justify-center mb-6 group-hover:bg-orange-600 transition">
                            <i class="ph-fill ph-briefcase text-3xl text-orange-400 group-hover:text-white"></i>
                        </div>
                        <h3 class="text-2xl font-bold mb-3">Mehnat Huquqi</h3>
                        <p class="text-sm text-gray-400 mb-6">Xodim va ish beruvchi o'rtasidagi munosabatlar.</p>
                        <button class="w-full bg-lawBlue hover:bg-blue-600 text-white py-3 rounded-xl font-semibold transition">
                            Boshlash
                        </button>
                    </div>

                    <div class="glass-card p-8 rounded-3xl relative group cursor-pointer" onclick="initTest('mixed')">
                        <div class="w-16 h-16 bg-pink-600/20 rounded-2xl flex items-center justify-center mb-6 group-hover:bg-pink-600 transition">
                            <i class="ph-fill ph-shuffle text-3xl text-pink-400 group-hover:text-white"></i>
                        </div>
                        <h3 class="text-2xl font-bold mb-3">Aralash Test</h3>
                        <p class="text-sm text-gray-400 mb-6">Barcha mavzulardan tasodifiy savollar.</p>
                        <button class="w-full bg-lawBlue hover:bg-blue-600 text-white py-3 rounded-xl font-semibold transition">
                            Boshlash
                        </button>
                    </div>

                </div>
            </div>
        </div>
    </section>

    <div id="testModal" class="fixed inset-0 bg-black/90 backdrop-blur-md z-50 items-center justify-center p-4 transition-opacity duration-300">
        <div class="glass-card rounded-3xl max-w-4xl w-full max-h-[90vh] flex flex-col overflow-hidden relative border border-gray-800">
            
            <div class="glass-nav p-6 flex items-center justify-between shrink-0 z-10">
                <div>
                    <h2 class="text-xl md:text-2xl font-bold text-white flex items-center gap-2">
                        <span id="modalTitle">Test</span>
                    </h2>
                    <p class="text-sm text-gray-400" id="questionCountDisplay">Savol 1 / 10</p>
                </div>
                <div class="flex items-center gap-4">
                    <div class="flex items-center gap-2 text-sm bg-white/5 px-3 py-1.5 rounded-lg border border-white/5">
                        <i class="ph-bold ph-clock text-lawBlue animate-pulse"></i>
                        <span id="timer" class="font-mono font-bold text-white">00:00</span>
                    </div>
                    <button onclick="closeTest()" class="w-10 h-10 rounded-full hover:bg-white/10 flex items-center justify-center transition text-gray-400 hover:text-white">
                        <i class="ph-bold ph-x text-xl"></i>
                    </button>
                </div>
            </div>

            <div class="h-1.5 bg-gray-800 w-full shrink-0">
                <div id="progressBar" class="h-full bg-gradient-to-r from-blue-600 to-cyan-400 progress-bar" style="width: 0%"></div>
            </div>

            <div class="flex-1 overflow-y-auto no-scrollbar p-6 md:p-10 relative">
                
                <div id="quizContent" class="max-w-3xl mx-auto transition-all duration-300">
                    <div class="mb-8">
                        <h3 class="text-xl md:text-2xl font-semibold mb-4 leading-relaxed" id="questionText">
                            Savol yuklanmoqda...
                        </h3>
                        <p class="text-sm text-gray-400 flex items-center gap-2">
                            <i class="ph-fill ph-info text-lawBlue"></i> Bitta to'g'ri javobni tanlang
                        </p>
                    </div>

                    <div class="space-y-4" id="optionsContainer">
                        </div>
                </div>

                <div id="resultContent" class="hidden flex-col items-center justify-center text-center h-full py-10">
                    <div class="relative mb-8">
                        <div class="result-circle" id="scoreCircle">
                            <span class="z-10 text-3xl font-black text-white" id="scorePercentage">0%</span>
                        </div>
                        <div class="absolute top-0 left-0 w-full h-full bg-blue-500 blur-[50px] opacity-20 rounded-full"></div>
                    </div>
                    
                    <h3 class="text-3xl font-bold text-white mb-2" id="resultTitle">Natija</h3>
                    <p class="text-gray-400 mb-8 max-w-md mx-auto" id="resultMessage">
                        Test yakunlandi.
                    </p>

                    <div class="grid grid-cols-3 gap-4 w-full max-w-md mb-8">
                        <div class="bg-white/5 p-4 rounded-2xl border border-white/5">
                            <div class="text-gray-400 text-xs uppercase mb-1">Jami</div>
                            <div class="text-xl font-bold text-white" id="totalQResult">0</div>
                        </div>
                        <div class="bg-green-500/10 p-4 rounded-2xl border border-green-500/20">
                            <div class="text-green-400 text-xs uppercase mb-1">To'g'ri</div>
                            <div class="text-xl font-bold text-green-400" id="correctQResult">0</div>
                        </div>
                        <div class="bg-red-500/10 p-4 rounded-2xl border border-red-500/20">
                            <div class="text-red-400 text-xs uppercase mb-1">Xato</div>
                            <div class="text-xl font-bold text-red-400" id="wrongQResult">0</div>
                        </div>
                    </div>

                    <div class="flex gap-4">
                        <button onclick="closeTest()" class="px-8 py-3 rounded-xl border border-white/10 hover:bg-white/5 transition font-medium">
                            Chiqish
                        </button>
                        <button onclick="restartTest()" class="px-8 py-3 rounded-xl bg-lawBlue hover:bg-blue-600 transition font-bold text-white flex items-center gap-2">
                            <i class="ph-bold ph-arrow-counter-clockwise"></i> Qayta ishlash
                        </button>
                    </div>
                </div>

            </div>

            <div id="quizFooter" class="glass-nav p-6 shrink-0 flex justify-between items-center border-t border-white/5">
                <button onclick="prevQuestion()" id="prevBtn" class="px-6 py-3 rounded-xl text-gray-400 hover:text-white hover:bg-white/5 transition disabled:opacity-30 disabled:cursor-not-allowed flex items-center gap-2" disabled>
                    <i class="ph-bold ph-arrow-left"></i> Oldingi
                </button>
                <button onclick="nextQuestion()" id="nextBtn" class="px-8 py-3 bg-lawBlue hover:bg-blue-600 text-white rounded-xl transition font-semibold disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2" disabled>
                    Keyingi <i class="ph-bold ph-arrow-right"></i>
                </button>
            </div>
        </div>
    </div>

    <script>
        // --- 1. MA'LUMOTLAR BAZASI (DATABASE) ---
        const testDatabase = {
            konstitutsiya: [
                { q: "O'zbekiston Respublikasi Konstitutsiyasi qachon qabul qilingan?", a: ["8-dekabr 1992-yil", "1-sentyabr 1991-yil", "31-avgust 1991-yil", "18-may 1992-yil"], c: 0 },
                { q: "O'zbekiston Respublikasida davlat hokimiyatining yagona manbai kim?", a: ["Prezident", "Oliy Majlis", "Xalq", "Sud"], c: 2 },
                { q: "Konstitutsiyaning yangi tahriri qachon referendum orqali qabul qilindi?", a: ["30-aprel 2023-yil", "1-may 2023-yil", "8-dekabr 2022-yil", "21-mart 2023-yil"], c: 0 },
                { q: "O'zbekiston Respublikasi Konstitutsiyasi necha bobdan iborat?", a: ["26 bob", "27 bob", "28 bob", "128 bob"], c: 2 },
                { q: "Sud hokimiyati qaysi organlar tomonidan amalga oshiriladi?", a: ["Faqat sudlar", "Prokuratura va sud", "Adliya vazirligi", "Ichki ishlar"], c: 0 }
            ],
            jinoyat: [
                { q: "Jinoyat kodeksiga ko'ra, jinoiy javobgarlikka tortishning eng kichik yoshi necha yosh?", a: ["16 yosh", "14 yosh", "18 yosh", "13 yosh"], c: 1 },
                { q: "Jinoyatning qasddan sodir etilishi nima?", a: ["Ehtiyotsizlik oqibati", "Shaxs o'z qilmishining ijtimoiy xavfliligini anglashi", "Majburlash ostida qilish", "Bilmasdan qilish"], c: 1 },
                { q: "O'lim jazosi O'zbekistonda qachon bekor qilingan?", a: ["2005-yil", "2008-yil", "2010-yil", "1999-yil"], c: 1 },
                { q: "Qilmishning jinoiyligini va jazoliligini nima belgilaydi?", a: ["Sud hukmi", "Prokuror qarori", "Faqat Jinoyat kodeksi", "Ichki ishlar buyrug'i"], c: 2 },
                { q: "Takroran sodir etilgan jinoyat nima deb ataladi?", a: ["Retsidiv", "Jinoiy uyushma", "Bezori", "Og'ir jinoyat"], c: 0 }
            ],
            fuqarolik: [
                { q: "Fuqarolik huquq layoqati qachon boshlanadi?", a: ["18 yoshda", "Tug'ilgan paytdan", "16 yoshda", "Nikohga kirganda"], c: 1 },
                { q: "Ishonchnoma ko'pi bilan necha yil muddatga berilishi mumkin?", a: ["1 yil", "3 yil", "5 yil", "Cheksiz"], c: 1 },
                { q: "Mulk huquqi nechta elementdan iborat?", a: ["2 ta (egalik, foydalanish)", "3 ta (egalik, foydalanish, tasarruf)", "4 ta", "1 ta"], c: 1 },
                { q: "Shartnoma nima?", a: ["Bir tomonlama xohish", "Ikki yoki undan ortiq shaxsning kelishuvi", "Sud qarori", "Davlat buyrug'i"], c: 1 },
                { q: "Ma'naviy zararni qoplash qanday amalga oshiriladi?", a: ["Faqat uzr so'rash", "Pul shaklida", "Qamoq jazosi", "Xizmat ko'rsatish"], c: 1 }
            ],
            dtm: [
                { q: "Huquqiy davlatning asosiy belgisi nima?", a: ["Kuchli armiya", "Qonun ustuvorligi", "Katta hudud", "Boy iqtisod"], c: 1 },
                { q: "BMT Bosh Assambleyasi Inson huquqlari umumjahon deklaratsiyasini qachon qabul qilgan?", a: ["1945 yil", "1948 yil 10 dekabr", "1950 yil", "1991 yil"], c: 1 },
                { q: "O'zbekiston Respublikasining davlat bayrog'i qachon qabul qilingan?", a: ["1991 yil 18 noyabr", "1992 yil 8 dekabr", "1991 yil 31 avgust", "1992 yil 2 iyul"], c: 0 },
                { q: "Mahalliy davlat hokimiyati organlariga kim rahbarlik qiladi?", a: ["Prokuror", "Hokim", "Sudya", "Xalq qabulxonasi"], c: 1 },
                { q: "Voyaga yetmaganlarga nisbatan eng ko'p qamoq jazosi muddati qancha?", a: ["15 yil", "10 yil", "20 yil", "25 yil"], c: 1 }
            ],
            mehnat: [
                { q: "Yangi Mehnat kodeksi qachon kuchga kirdi?", a: ["2023 yil 30 aprel", "2022 yil 1 yanvar", "2023 yil 1 yanvar", "2020 yil"], c: 0 },
                { q: "Normal ish vaqti haftasiga necha soatdan oshmasligi kerak?", a: ["36 soat", "40 soat", "42 soat", "48 soat"], c: 1 },
                { q: "Sinov muddati ko'pi bilan qancha bo'lishi mumkin?", a: ["1 oy", "3 oy (ayrim hollarda 6 oy)", "2 hafta", "1 yil"], c: 1 },
                { q: "Mehnat ta'tili eng kamida necha ish kuni bo'lishi kerak?", a: ["15 kun", "21 kun", "24 kun", "30 kun"], c: 1 },
                { q: "Xodim ishdan bo'shash haqida necha kun oldin ogohlantirishi kerak?", a: ["1 hafta", "2 hafta (14 kun)", "1 oy", "3 kun"], c: 1 }
            ]
        };

        // Aralash testni hosil qilish
        testDatabase.mixed = [
            ...testDatabase.konstitutsiya,
            ...testDatabase.jinoyat,
            ...testDatabase.fuqarolik,
            ...testDatabase.dtm
        ].sort(() => Math.random() - 0.5).slice(0, 10); // 10 random questions

        // --- 2. GLOBAL O'ZGARUVCHILAR ---
        let currentQuestions = [];
        let currentIndex = 0;
        let userAnswers = []; // [null, 1, 3, null...]
        let timerInterval;
        let timeRemaining = 0;
        let currentCategory = '';

        // --- 3. ASOSIY FUNKSIYALAR ---

        function initTest(category) {
            currentCategory = category;
            
            // Agar mixed bo'lsa har safar yangilaymiz
            if (category === 'mixed') {
                 testDatabase.mixed = [
                    ...testDatabase.konstitutsiya,
                    ...testDatabase.jinoyat,
                    ...testDatabase.fuqarolik,
                    ...testDatabase.dtm
                ].sort(() => Math.random() - 0.5).slice(0, 10);
            }

            currentQuestions = testDatabase[category];
            currentIndex = 0;
            userAnswers = new Array(currentQuestions.length).fill(null);
            
            // Modalni ochish va UI ni tozalash
            document.getElementById('testModal').classList.add('active');
            document.getElementById('quizContent').classList.remove('hidden');
            document.getElementById('quizFooter').classList.remove('hidden');
            document.getElementById('resultContent').classList.add('hidden');
            document.getElementById('resultContent').classList.remove('flex');
            
            // Sarlavha
            const titles = {
                'konstitutsiya': 'Konstitutsiya Testi',
                'jinoyat': 'Jinoyat Huquqi',
                'fuqarolik': 'Fuqarolik Huquqi',
                'mehnat': 'Mehnat Huquqi',
                'dtm': 'DTM Testlar',
                'mixed': 'Aralash Test'
            };
            document.getElementById('modalTitle').textContent = titles[category] || 'Test';

            // Timer (har bir savolga 1 daqiqadan)
            timeRemaining = currentQuestions.length * 60;
            startTimer();

            // Birinchi savolni yuklash
            renderQuestion();
        }

        function renderQuestion() {
            const qData = currentQuestions[currentIndex];
            
            // Matnlarni yangilash
            document.getElementById('questionText').textContent = qData.q;
            document.getElementById('questionCountDisplay').textContent = `Savol ${currentIndex + 1} / ${currentQuestions.length}`;
            
            // Progress bar
            const percent = ((currentIndex + 1) / currentQuestions.length) * 100;
            document.getElementById('progressBar').style.width = `${percent}%`;

            // Variantlarni chizish
            const container = document.getElementById('optionsContainer');
            container.innerHTML = ''; // Tozalash

            qData.a.forEach((optText, idx) => {
                const div = document.createElement('div');
                div.className = `option-card glass-card p-4 md:p-5 rounded-xl flex items-center gap-4 ${userAnswers[currentIndex] === idx ? 'selected' : ''}`;
                div.onclick = () => selectOption(idx);
                
                div.innerHTML = `
                    <div class="w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm shrink-0 
                        ${userAnswers[currentIndex] === idx ? 'bg-lawBlue text-white' : 'bg-gray-700/50 text-gray-300'}">
                        ${String.fromCharCode(65 + idx)}
                    </div>
                    <div class="flex-1 text-sm md:text-base font-medium text-gray-200">${optText}</div>
                    ${userAnswers[currentIndex] === idx ? '<i class="ph-fill ph-check-circle text-lawBlue text-xl"></i>' : ''}
                `;
                container.appendChild(div);
            });

            // Tugmalarni boshqarish
            document.getElementById('prevBtn').disabled = currentIndex === 0;
            const nextBtn = document.getElementById('nextBtn');
            
            if (currentIndex === currentQuestions.length - 1) {
                nextBtn.innerHTML = 'Tugatish <i class="ph-bold ph-check"></i>';
                nextBtn.classList.add('bg-green-600', 'hover:bg-green-700');
                nextBtn.classList.remove('bg-lawBlue', 'hover:bg-blue-600');
            } else {
                nextBtn.innerHTML = 'Keyingi <i class="ph-bold ph-arrow-right"></i>';
                nextBtn.classList.add('bg-lawBlue', 'hover:bg-blue-600');
                nextBtn.classList.remove('bg-green-600', 'hover:bg-green-700');
            }
            
            // Agar javob tanlanmagan bo'lsa "Keyingi" tugmasini o'chirish (ixtiyoriy, hozir ochiq qoldiraman)
             nextBtn.disabled = userAnswers[currentIndex] === null;
        }

        function selectOption(optionIndex) {
            userAnswers[currentIndex] = optionIndex;
            renderQuestion(); // UI ni yangilash (borderlar uchun)
        }

        function nextQuestion() {
            if (currentIndex < currentQuestions.length - 1) {
                currentIndex++;
                renderQuestion();
            } else {
                finishTest();
            }
        }

        function prevQuestion() {
            if (currentIndex > 0) {
                currentIndex--;
                renderQuestion();
            }
        }

        // --- 4. NATIJA VA TIMER ---

        function startTimer() {
            clearInterval(timerInterval);
            const timerEl = document.getElementById('timer');
            
            timerInterval = setInterval(() => {
                timeRemaining--;
                const m = Math.floor(timeRemaining / 60).toString().padStart(2, '0');
                const s = (timeRemaining % 60).toString().padStart(2, '0');
                timerEl.textContent = `${m}:${s}`;
                
                // Vaqt tugaganda qizil rangga kirsin
                if (timeRemaining < 60) timerEl.classList.add('text-red-500');
                else timerEl.classList.remove('text-red-500');

                if (timeRemaining <= 0) {
                    clearInterval(timerInterval);
                    finishTest();
                }
            }, 1000);
        }

        function finishTest() {
            clearInterval(timerInterval);
            
            // Hisoblash
            let score = 0;
            currentQuestions.forEach((q, idx) => {
                if (userAnswers[idx] === q.c) score++;
            });

            // UI almashtirish
            document.getElementById('quizContent').classList.add('hidden');
            document.getElementById('quizFooter').classList.add('hidden');
            
            const resultContent = document.getElementById('resultContent');
            resultContent.classList.remove('hidden');
            resultContent.classList.add('flex');

            // Ma'lumotlarni to'ldirish
            const percent = Math.round((score / currentQuestions.length) * 100);
            document.getElementById('scorePercentage').textContent = `${percent}%`;
            document.getElementById('scoreCircle').style.setProperty('--percent', `${percent}%`);
            
            document.getElementById('totalQResult').textContent = currentQuestions.length;
            document.getElementById('correctQResult').textContent = score;
            document.getElementById('wrongQResult').textContent = currentQuestions.length - score;

            // Xabar matni
            const msgEl = document.getElementById('resultMessage');
            const titleEl = document.getElementById('resultTitle');
            
            if (percent >= 90) {
                titleEl.textContent = "Ajoyib Natija! üéâ";
                msgEl.textContent = "Siz deyarli barcha savollarga to'g'ri javob berdingiz. Haqiqiy ekspert!";
            } else if (percent >= 70) {
                titleEl.textContent = "Yaxshi Natija üëç";
                msgEl.textContent = "Bilimingiz yomon emas, lekin yana ozgina tayyorgarlik kerak.";
            } else {
                titleEl.textContent = "Harakat qiling üí™";
                msgEl.textContent = "Natija past, lekin tushkunlikka tushmang. Qayta o'qib chiqing.";
            }
        }

        function restartTest() {
            initTest(currentCategory);
        }

        function closeTest() {
            if(document.getElementById('resultContent').classList.contains('hidden')) {
                 if(confirm("Testni yopmoqchimisiz? Natijalar saqlanmaydi.")) {
                    document.getElementById('testModal').classList.remove('active');
                    clearInterval(timerInterval);
                 }
            } else {
                document.getElementById('testModal').classList.remove('active');
                clearInterval(timerInterval);
            }
        }
    </script>
</body>
</html>
